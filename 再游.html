<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶£æ—…è¿½é£ - æœ€ç»ˆå®Œç¾ç‰ˆ</title>
    <style>
    :root {
        --soft-yellow: #FFF3B0;
        --soft-pink: #FFB3D9;
        --soft-green: #B8E994;
        --glass-bg: rgba(255, 255, 255, 0.25);
        --text-dark: #5A5A5A;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        background: radial-gradient(circle at 50% 20%,
            var(--soft-yellow) 0%,
            var(--soft-pink) 50%,
            var(--soft-green) 100%);
        font-family: 'Space Grotesk', sans-serif;
        min-height: 100vh;
        backdrop-filter: blur(20px);
        overflow-x: hidden;
        position: relative;
    }

    .mellow-header {
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        position: relative;
        z-index: 10;
    }

    .logo-container {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .logo-container h1 {
        font-family: 'Noto Serif SC', serif;
        color: var(--text-dark);
        font-size: 2.2rem;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .natural-emojis {
        display: flex;
        gap: 0.5rem;
        font-size: 1.5rem;
    }

    .search-container {
        display: flex;
        gap: 0.5rem;
    }

    .mellow-button {
        background: rgba(255,255,255,0.9);
        border: none;
        color: var(--text-dark);
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .mellow-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
    }

    .mellow-card {
        background: var(--glass-bg);
        border-radius: 24px;
        padding: 1.8rem;
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        border: 1px solid rgba(255,255,255,0.3);
    }

    .mellow-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 28px rgba(0,0,0,0.12);
    }

    .result-bubble {
        margin-top: 1.5rem;
        padding: 1.2rem;
        background: rgba(255,255,255,0.85);
        border-radius: 16px;
        min-height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        line-height: 1.6;
        color: var(--text-dark);
        box-shadow: inset 0 4px 12px rgba(0,0,0,0.05);
    }

    /* æ—¥è®°æ¨¡å— */
    .diary-module {
        position: relative;
        width: 100%;
        background: var(--glass-bg);
        border-radius: 24px;
        padding: 1.2rem;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.3);
    }

    @media (max-width: 1200px) {
        .mellow-grid {
            padding: 2rem;
        }
    }

    .diary-header {
        display: flex;
        gap: 0.8rem;
        margin-bottom: 1rem;
    }

    #diaryDate {
        flex: 1;
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 8px;
        padding: 0.5rem;
        font-family: inherit;
    }

    .diary-content {
        max-height: 400px;
        overflow-y: auto;
    }

    .diary-record {
        background: rgba(184,233,148,0.2);
        border-radius: 8px;
        padding: 0.8rem;
        margin: 0.5rem 0;
        font-size: 0.9em;
    }

    #diaryNote {
        width: 100%;
        height: 80px;
        margin: 1rem 0;
        padding: 0.8rem;
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 8px;
        resize: none;
    }

    /* å¯¹è¯æ¨¡å— */
    .chat-module {
        background: var(--glass-bg);
        border-radius: 24px;
        padding: 1.5rem;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.3);
    }

    .chat-history {
        height: 300px;
        overflow-y: auto;
        margin-bottom: 1rem;
    }

    .chat-bubble {
        background: rgba(255,255,255,0.85);
        border-radius: 15px;
        padding: 1rem;
        margin: 0.5rem 0;
        max-width: 80%;
    }

    .chat-bubble.fox {
        background: rgba(255,167,38,0.15);
        align-self: flex-start;
    }

    .chat-input-group {
        display: flex;
        gap: 0.5rem;
    }

    .chat-input {
        flex: 1;
        padding: 0.8rem;
        border-radius: 12px;
        border: 1px solid rgba(0,0,0,0.1);
    }

    /* éŸ³ä¹æ’­æ”¾å™¨ */
    .music-panel {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        padding: 1rem;
        width: 200px;
        border-radius: 24px;
        transform: scale(0);
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        z-index: 100;
        border: 1px solid rgba(255,255,255,0.3);
    }

    .music-panel.active {
        transform: scale(1);
        opacity: 1;
    }

    .music-minimized {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        animation: bounce 1s infinite;
        z-index: 100;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
    }

    /* æ¬¢è¿å¼¹çª— */
    .welcome-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9); /* æ›´è½»æ¾æ˜å¿«çš„èƒŒæ™¯è‰² */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .welcome-content {
        background: rgba(255, 255, 255, 0.95); /* æ›´æ˜äº®çš„èƒŒæ™¯è‰² */
        border-radius: 24px;
        padding: 2rem;
        text-align: center;
        max-width: 500px;
        box-shadow: 0 12px 32px rgba(0,0,0,0.1);
        border: 1px solid rgba(255,255,255,0.5);
    }

    .welcome-content h2 {
        color: #FF6B6B; /* æ›´æ´»æ³¼çš„æ ‡é¢˜é¢œè‰² */
        margin-bottom: 1rem;
    }

    .welcome-content p {
        color: #5A5A5A;
        margin-bottom: 1.5rem;
        font-size: 1.1rem;
    }

    .welcome-close {
        background: #4ECDC4; /* æ›´æ¸…æ–°çš„æŒ‰é’®é¢œè‰² */
        border: none;
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .welcome-close:hover {
        background: #27AE60; /* æŒ‰é’®æ‚¬åœæ—¶çš„é¢œè‰²å˜åŒ– */
    }

    /* é£˜è½çš„ emoji */
    .emoji {
        position: absolute;
        font-size: 2rem;
        animation: fall linear infinite;
        z-index: 2; /* ç¡®ä¿ emoji é£˜è½åœ¨å†…å®¹æ¡†ä¸Šæ–¹ */
    }

    @keyframes fall {
        0% {
            transform: translateY(-100px);
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            transform: translateY(calc(100vh + 100px));
            opacity: 0;
        }
    }
<style>
/* æ–°å¢æ ·å¼ */
.calendar-container {
    padding: 1rem;
}

.calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
}

.calendar-header h3 {
    color: var(--text-dark);
    font-weight: 500;
}

.icon-btn {
    padding: 0.5rem 1rem;
    border-radius: 8px;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-bottom: 1.5rem;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.3);
    border-radius: 8px;
    font-size: 0.9em;
    transition: all 0.2s ease;
}

.calendar-day.has-record {
    background: linear-gradient(135deg, 
        var(--soft-pink) 20%, 
        var(--soft-green) 80%);
    color: white;
    font-size: 0; /* éšè—æ•°å­— */
}

.calendar-day.has-record::after {
    content: "ğŸŒ¸";
    font-size: 1.2rem;
}

.progress-container {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: rgba(255,255,255,0.3);
    border-radius: 4px;
    overflow: hidden;
}

.progress-bar::after {
    content: "";
    display: block;
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, 
        var(--soft-green) 0%, 
        var(--soft-pink) 100%);
    transition: width 0.5s ease;
}
.progress-bar::after {
    /* å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
    width: var(--progress-width, 0%); /* æ·»åŠ è¿™ä¸€è¡Œ */
}
#progressText {
    color: var(--text-dark);
    font-size: 0.9em;
    white-space: nowrap;
}
</style>

    </style>
</head>
<body>
    <header class="mellow-header">
        <div class="logo-container">
            <h1>è¶£æ—…è¿½é£</h1>
            <div class="natural-emojis">
                ğŸŒ ğŸŒˆ ğŸŒ¸ ğŸŒ¿ ğŸŒŸ
            </div>
        </div>
        <div class="search-container">
            <input type="text" class="mellow-button" id="searchInput" placeholder="ğŸ” æœç´¢æŒ‰é’®åŠŸèƒ½æœç´¢...">
            <button class="mellow-button" onclick="searchDiary()">æœç´¢</button>
        </div>
    </header>

    <main class="mellow-grid">
        <!-- åŠŸèƒ½å¡ç‰‡ -->
        <section class="mellow-card">
            <h2>ğŸŒ¿ è‡ªç„¶ç½—ç›˜</h2>
            <div class="hologram-effect"></div>
            <button class="mellow-button" onclick="generateCompass()">ç”Ÿæˆæ¼«æ¸¸è·¯å¾„</button>
            <div class="result-bubble" id="compass-result"></div>
        </section>

        <section class="mellow-card">
            <h2>ğŸ æƒŠå–œç›²ç›’</h2>
            <div class="hologram-effect"></div>
            <button class="mellow-button" onclick="openMysteryBox()">å¼€å¯ä»Šæ—¥æƒŠå–œ</button>
            <div class="result-bubble" id="mystery-result"></div>
        </section>

        <section class="mellow-card">
            <h2>ğŸ² å‘½è¿éª°å­</h2>
            <div class="hologram-effect"></div>
            <button class="mellow-button" onclick="rollDice()">æŠ•æ·éšæœºæŒ‡ä»¤</button>
            <div class="result-bubble" id="dice-result"></div>
        </section>
<section class="mellow-card">
    <h2>ğŸ“† è¿½é£æ—¥å†</h2>
    <div class="calendar-container">
        <!-- æ—¥å†å¤´éƒ¨ -->
        <div class="calendar-header">
            <button class="mellow-button icon-btn" onclick="changeMonth(-1)">â—€</button>
            <h3 id="currentMonth"></h3>
            <button class="mellow-button icon-btn" onclick="changeMonth(1)">â–¶</button>
        </div>
        
        <!-- æ—¥å†ä¸»ä½“ -->
        <div class="calendar-grid" id="calendarGrid"></div>
        
        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
            <span id="progressText">ä¼´ä½ 0åœºè¿½é£</span>
        </div>
    </div>
</section>

       <!-- å¯¹è¯æ¨¡å— -->
        <div class="chat-module">
            <h2>ğŸ¦Š æ—…è¡Œå•†ç¤¾</h2>
            <div class="chat-history" id="chatHistory">
                <div class="chat-bubble fox">
                    <div class="fox-icon">ğŸ¦Š</div>
                    <p>æ¬¢è¿æ¥åˆ°æ—…è¡Œå•†ç¤¾ï¼æˆ‘æ˜¯å°ç‹ç‹¸è€æ¿ï¼Œå¯ä»¥é—®æˆ‘è¿™äº›é—®é¢˜ï¼š<br>
                    â€¢ ä»Šå¤©çš„ä»»åŠ¡å»ºè®®<br>
                    â€¢ å¤©æ°”æƒ…å†µ<br>
                    â€¢ è£…å¤‡æ¨è<br>
                    â€¢ è®°å½•å¿ƒæƒ…</p>
                </div>
            </div>
            <div class="chat-input-group">
                <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯...">
                <button class="mellow-button" onclick="sendMessage()">å‘é€</button>
            </div>
        </div>

        <!-- æ—¥è®°æ¨¡å— -->
        <div class="diary-module">
            <div class="diary-header">
                <input type="date" id="diaryDate">
                <button class="mellow-button" onclick="loadDiary()">ğŸ“… æŸ¥çœ‹æ—¥è®°</button>
            </div>
            <div class="diary-content">
                <div id="recordsList"></div>
                <textarea id="diaryNote" placeholder="âœï¸ è®°å½•æ­¤åˆ»å¿ƒæƒ…..."></textarea>
                <button onclick="saveDiary()" class="mellow-button">ğŸ’¾ ä¿å­˜æ—¥è®°</button>
                <div id="encouragement"></div>
            </div>
            <button onclick="clearDiary()" class="mellow-button" style="margin-top:1rem">âš ï¸ æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
        </div>
    </main>

    <!-- éŸ³ä¹ç»„ä»¶ -->
    <div class="music-minimized" onclick="toggleMusicPanel()">
        <span class="music-emoji">ğŸµ</span>
    </div>
    <div class="music-panel" id="musicPanel">
        <div class="music-header">
            <span>ğŸ¶ æ—…è¡Œæ—‹å¾‹</span>
            <button class="mellow-button" onclick="toggleMusicPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <audio id="bgm" loop></audio>
        <div class="playlist">
            <button class="mellow-button" onclick="playMusic(0)">ğŸŒ¿ æ£®æ—ä¹‹éŸ³</button>
            <button class="mellow-button" onclick="playMusic(1)">ğŸŒŠ æµ·æµªéŸµå¾‹</button>
            <button class="mellow-button" onclick="playMusic(2)">â˜•ï¸ å’–å•¡é¦†æ—¶å…‰</button>
        </div>
    </div>

    <!-- æ¬¢è¿å¼¹çª— -->
    <div class="welcome-modal" id="welcomeModal">
        <div class="welcome-content">
            <h2>æ¬¢è¿å›æ¥ï¼</h2>
            <p id="welcomeMessage">ç»§ç»­æˆ‘ä»¬çš„æ¢é™©æ—…ç¨‹å§ï¼</p>
            <button class="welcome-close" onclick="closeWelcomeModal()">å¼€å§‹æ¢é™©</button>
        </div>
    </div>

    <script>
    // æ•°æ®å­˜å‚¨
    const travelData = {
        compass: [
            'æ²¿ç€é£å¹æ¥çš„æ–¹å‘æ¼«æ­¥ååˆ†é’Ÿ',
            'å¯»æ‰¾ä¸‰ç‰‡ä¸åŒå½¢çŠ¶çš„å¶å­',
            'è·Ÿéšäº‘æœµç§»åŠ¨çš„è½¨è¿¹è¡Œèµ°'
        ],
        mystery: [
            'æ”¶é›†äº”ç§è‡ªç„¶å£°éŸ³',
            'æ‰¾åˆ°ä¸‰ç§ä¸åŒçš„åœ°é¢çº¹ç†',
            'è®°å½•ä¸‰ç§å…‰å½±å˜åŒ–çš„ç¬é—´',
            'å¯»æ‰¾ä¼šåå…‰çš„ç‰©ä½“è¡¨é¢',
            'å‘ç°å››ç§ä¸åŒçš„ç»¿è‰²'
        ],
        dice: {
            1: "åœ¨ä¸‹ä¸€è·¯å£å·¦è½¬æ¢ç´¢",
            2: "å¾€å‰èµ°ä¸¤ä¸ªåå­—è·¯å£",
            3: "æ‹æ‘„ä¸‰å¤„æœ‰è¶£çš„å»ºç­‘ç»†èŠ‚",
            4: "å¯»æ‰¾å››ä¸ªåœ†å½¢ç‰©ä½“å¹¶æ‹ç…§",
            5: "æ”¶é›†äº”ç§ä¸åŒçš„å£°éŸ³",
            6: "ä¸å…­ä½é™Œç”Ÿäººå¾®ç¬‘æ‰“æ‹›å‘¼",
            7: "å¯»æ‰¾ä¸ƒç§é¢œè‰²çš„è‡ªç„¶ç‰©ä½“",
            8: "æ‹æ‘„å…«ç§ä¸åŒæè´¨çš„è¡¨é¢",
            9: "å‘ç°ä¹å®«æ ¼æ„å›¾çš„åœºæ™¯",
            10: "è®°å½•åä¸ªç‰¹è‰²åº—é“ºæ‹›ç‰Œ",
            11: "å¯»æ‰¾åä¸€ç‰‡ä¸åŒå½¢çŠ¶çš„å¶å­",
            12: "æ²¿å½“å‰æ–¹å‘æ¼«æ­¥åäºŒåˆ†é’Ÿ"
        }
    };

    // éŸ³ä¹é“¾æ¥
    const musicList = [
        "https://assets.mixkit.co/music/preview/mixkit-forest-breeze-1293.mp3 ",
        "https://assets.mixkit.co/music/preview/mixkit-deep-relaxation-443.mp3 ",
        "https://assets.mixkit.co/music/preview/mixkit-lofi-chill-01-627.mp3 "
    ];

    // æœç´¢åŠŸèƒ½
    function searchDiary() {
        const searchTerm = document.getElementById('searchInput').value.trim();
        if (!searchTerm) return;

        // æ£€æŸ¥æ˜¯å¦æ˜¯æ—¥æœŸæ ¼å¼ï¼ˆYYYY-MM-DDï¼‰
        const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
        if (dateRegex.test(searchTerm)) {
            // å¦‚æœæ˜¯æ—¥æœŸæ ¼å¼ï¼ŒåŠ è½½å¯¹åº”æ—¥æœŸçš„æ—¥è®°
            document.getElementById('diaryDate').value = searchTerm;
            loadDiary();
        } else {
            // å¦‚æœä¸æ˜¯æ—¥æœŸæ ¼å¼ï¼Œæ‰§è¡Œé»˜è®¤æœç´¢é€»è¾‘
            alert(`æœç´¢åŠŸèƒ½å·²è§¦å‘ï¼Œå…³é”®è¯ï¼š${searchTerm}`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šæœç´¢é€»è¾‘
        }
    }

    // æ ¸å¿ƒåŠŸèƒ½
    function generateCompass() {
        const resultBox = document.getElementById('compass-result');
        resultBox.textContent = travelData.compass[Math.floor(Math.random()*3)];
        localStorage.setItem('lastActionType', 'æŒ‡å—é’ˆå¯¼èˆª');
        localStorage.setItem('lastActionContent', resultBox.textContent);
    }

    function openMysteryBox() {
        const resultBox = document.getElementById('mystery-result');
        resultBox.textContent = travelData.mystery[Math.floor(Math.random()*5)];
        localStorage.setItem('lastActionType', 'æ—…è¡Œç›²ç›’');
        localStorage.setItem('lastActionContent', resultBox.textContent);
    }

    function rollDice() {
        const result = Math.ceil(Math.random()*12);
        const resultBox = document.getElementById('dice-result');
        resultBox.textContent = `${result}å·æŒ‡ä»¤ â†’ ${travelData.dice[result]}`;
        localStorage.setItem('lastActionType', 'å‘½è¿éª°å­');
        localStorage.setItem('lastActionContent', resultBox.textContent);
    }

    // æ—¥è®°ç³»ç»Ÿ
    const encouragements = [
        "ä»Šå¤©åˆæ˜¯å……æ»¡æƒŠå–œçš„ä¸€å¤©å‘¢ï¼(à¹‘>á´—<à¹‘)",
        "ä½ çš„å†’é™©æ•…äº‹çœŸç²¾å½©ï¼âœ§Ù©(ËŠÏ‰Ë‹*)Ùˆâœ§",
        "æ¯ä¸€æ­¥éƒ½æ˜¯ç‹¬ç‰¹çš„é£æ™¯å“¦ï½â™ª(^âˆ‡^*)",
        "è®°å¿†å®ç®±åˆå¢åŠ æ–°æ”¶è—å•¦ï¼( â€¢Ì€ Ï‰ â€¢Ì )âœ§",
        "æ—…è¡Œè¾¾äººéä½ è«å±ï¼Ù©(â—•â€¿â—•)Û¶"
    ];

    function loadDiary() {
        const date = document.getElementById('diaryDate').value;
        const records = JSON.parse(localStorage.getItem(`diary_${date}`)) || [];
        document.getElementById('recordsList').innerHTML = records.map(r => `
            <div class="diary-record">
                <strong>${r.time}</strong> 
                [${r.type}] ${r.content}
                ${r.note ? `<br>ğŸ“ ${r.note}` : ''}
            </div>
        `).join('');
    }

    function saveDiary() {
        const record = {
            time: new Date().toLocaleTimeString('zh-CN'),
            type: localStorage.getItem('lastActionType') || 'æœªçŸ¥ç±»å‹',
            content: localStorage.getItem('lastActionContent') || 'æ— è®°å½•',
            note: document.getElementById('diaryNote').value
        };
        const date = document.getElementById('diaryDate').value || new Date().toISOString().split('T')[0];
        const records = JSON.parse(localStorage.getItem(`diary_${date}`)) || [];
        records.push(record);
        localStorage.setItem(`diary_${date}`, JSON.stringify(records));
        document.getElementById('encouragement').innerHTML = encouragements[Math.floor(Math.random()*5)];
        loadDiary();
        document.getElementById('diaryNote').value = '';
    }

    function clearDiary() {
        if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥è®°è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
            localStorage.clear();
            loadDiary();
        }
    }


    // å¯¹è¯åŠŸèƒ½
    function sendMessage() {
        const input = document.getElementById('chatInput');
        const history = document.getElementById('chatHistory');
        
        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        history.innerHTML += `
            <div class="chat-bubble" style="margin-left: auto">
                ${input.value}
            </div>
        `;

        // è·å–å°ç‹ç‹¸å›å¤
        const response = getFoxResponse(input.value);
        history.innerHTML += `
            <div class="chat-bubble fox">
                ğŸ¦Šï¼š${response}
            </div>
        `;

        // æ»šåŠ¨åˆ°åº•éƒ¨
        history.scrollTop = history.scrollHeight;
        input.value = '';
    }

// åœ¨foxResponseså¯¹è±¡å‰æ·»åŠ ä»»åŠ¡å»ºè®®å‡½æ•°
function getTaskAdvice(task) {
    const adviceMap = {
        "æ²¿ç€é£å¹æ¥çš„æ–¹å‘æ¼«æ­¥ååˆ†é’Ÿ": "å¯ä»¥æ²¿é€”è§‚å¯Ÿäº‘æœµå½¢çŠ¶çš„å˜åŒ–",
        "å¯»æ‰¾ä¸‰ç‰‡ä¸åŒå½¢çŠ¶çš„å¶å­": "å»ºè®®æºå¸¦ä¾¿æºæ ‡æœ¬å¤¹è¿›è¡Œæ”¶é›†",
        "è·Ÿéšäº‘æœµç§»åŠ¨çš„è½¨è¿¹è¡Œèµ°": "è®°å¾—æ¯5åˆ†é’Ÿæ‹ä¸€å¼ äº‘å±‚å˜åŒ–ç…§ç‰‡",
        "æ”¶é›†äº”ç§è‡ªç„¶å£°éŸ³": "æ¨èä½¿ç”¨æ‰‹æœºå½•éŸ³åŠŸèƒ½å¹¶æ ‡æ³¨æ—¶é—´åœ°ç‚¹",
        "æ‰¾åˆ°ä¸‰ç§ä¸åŒçš„åœ°é¢çº¹ç†": "å¯å°è¯•ç”¨æ‹“å°çº¸è®°å½•",
        // æ·»åŠ å…¶ä»–ä»»åŠ¡å¯¹åº”çš„å»ºè®®...
        "default": "ä¿æŒå¥½å¥‡å¿ƒï¼Œäº«å—æ¢ç´¢è¿‡ç¨‹ï¼"
    };
    return adviceMap[task] || adviceMap.default;
}

// ä¿®æ”¹åçš„getFoxResponseå‡½æ•°
function getFoxResponse(text) {
    const foxResponses = {
        "å¤©æ°”": ["è®°å¾—å¸¦ä¼å“¦", "ä»Šå¤©é˜³å…‰å¾ˆå¥½é€‚åˆæ‹ç…§", "å¾®é£é€‚åˆæ”¾é£ç­"],
        "è£…å¤‡": ["æ¨èæºå¸¦ä¾¿æºæ°´å£¶", "è®°å¾—ç©¿èˆ’é€‚çš„è¿åŠ¨é‹", "å¸¦ä¸Šé˜²æ™’éœœ"],
        "ä»»åŠ¡": () => {
            const todayTask = localStorage.getItem('lastActionContent') || "éšæœºæ¢ç´¢";
            // æ·»åŠ ä»»åŠ¡å­˜åœ¨æ€§æ£€æŸ¥
            if (!todayTask || todayTask === "æ— è®°å½•") {
                return "ä½ è¿˜æ²¡æœ‰ç”Ÿæˆä»Šæ—¥ä»»åŠ¡å“¦ï¼Œå…ˆè¯•è¯•è‡ªç„¶ç½—ç›˜æˆ–å‘½è¿éª°å­å§ï¼ğŸ¯";
            }
            return `æ ¹æ®ä½ çš„ä»Šæ—¥ä»»åŠ¡ã€Œ${todayTask}ã€ï¼Œå»ºè®®ï¼š${getTaskAdvice(todayTask)}`;
        },
        "å¿ƒæƒ…": ["è®°å½•å¿ƒæƒ…æ˜¯æ—…è¡Œä¸­æœ€ç¾å¥½çš„éƒ¨åˆ†", "å¿ƒæƒ…ä¼šæˆä¸ºå›å¿†ä¸­æœ€çè´µçš„éƒ¨åˆ†"],
        "default": ["å¾ˆæœ‰è¶£çš„æé—®å‘¢", "è¦ä¸è¦è¯•è¯•æ¢ä¸ªè§’åº¦æ€è€ƒï¼Ÿ", "è¿™ä¸ªéœ€è¦äº²èº«ä½“éªŒæ‰çŸ¥é“å“¦"]
    };

    // ä¼˜åŒ–å…³é”®è¯åŒ¹é…é€»è¾‘
    const matchedKey = Object.keys(foxResponses).find(key => 
        text.includes(key) || 
        (key === "ä»»åŠ¡" && /ä»»åŠ¡|æŒ‘æˆ˜|ä»Šæ—¥ç›®æ ‡/.test(text))
    );

    if (matchedKey) {
        const response = foxResponses[matchedKey];
        return typeof response === 'function' ? 
            response() : 
            response[Math.floor(Math.random()*response.length)];
    }
    return foxResponses.default[Math.floor(Math.random()*foxResponses.default.length)];
}   
 // éŸ³ä¹ç³»ç»Ÿ
    let currentTrack = 0;
    const audio = document.getElementById('bgm');

    function playMusic(index) {
        currentTrack = index;
        audio.src = musicList[index];
        try {
            audio.play();
        } catch (error) {
            console.log("éŸ³ä¹åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é“¾æ¥åˆæ³•æ€§");
        }
    }

    function toggleMusicPanel() {
        const panel = document.getElementById('musicPanel');
        panel.classList.toggle('active');
    }

    // æ¬¢è¿å¼¹çª—
    const welcomeMessages = [
        "æ¬¢è¿å›æ¥ï¼ç»§ç»­æˆ‘ä»¬çš„æ¢é™©æ—…ç¨‹å§ï¼",
        "å˜¿ï¼Œæ—…è¡Œè€…ï¼å‡†å¤‡å¥½æ–°çš„å†’é™©äº†å—ï¼Ÿ",
        "ä»Šå¤©åˆæ˜¯å……æ»¡æƒŠå–œçš„ä¸€å¤©ï¼Œå‡ºå‘å§ï¼",
        "æ—…é€”ä¸­çš„æ¯ä¸€åˆ»éƒ½å€¼å¾—çè—ï¼",
        "æ–°çš„æ—…ç¨‹å³å°†å¼€å§‹ï¼Œä½ å‡†å¤‡å¥½äº†å—ï¼Ÿ"
    ];

    function showWelcomeModal() {
        const welcomeModal = document.getElementById('welcomeModal');
        const welcomeMessage = document.getElementById('welcomeMessage');
        welcomeMessage.textContent = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
        welcomeModal.style.display = 'flex';
    }

    function closeWelcomeModal() {
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'none';
    }

    // é£˜è½çš„ emoji
    function createEmojis() {
        const emojis = ['ğŸŒ', 'ğŸŒˆ', 'ğŸŒ¸', 'ğŸ‰', 'âœ¨', 'ğŸ’«', 'ğŸŒŸ', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒº'];
        const emojiCount = 30;
        const headerHeight = document.querySelector('.mellow-header').offsetHeight;

        for (let i = 0; i < emojiCount; i++) {
            const emoji = document.createElement('div');
            emoji.className = 'emoji';
            emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            emoji.style.left = `${Math.random() * 100}%`;
            emoji.style.top = `-${Math.random() * 100}px`;
            emoji.style.animationDuration = `${5 + Math.random() * 10}s`;
            emoji.style.animationDelay = `${Math.random() * 5}s`;
            document.body.appendChild(emoji);
        }
    }

    // åˆå§‹åŒ–è®¾ç½®
    window.addEventListener('load', () => {
        try {
            playMusic(0);
        } catch (error) {
            console.log("éŸ³ä¹åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é“¾æ¥åˆæ³•æ€§");
        }
        document.getElementById('musicPanel').classList.remove('active');
        showWelcomeModal();
        createEmojis();
    });
    </script>
<script>
// æ–°å¢æ—¥å†åŠŸèƒ½
let currentDate = new Date();

function updateCalendar() {
    // è®¡ç®—å½“æœˆä¿¡æ¯
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const firstDay = new Date(year, month, 1).getDay();

    // æ›´æ–°æœˆä»½æ˜¾ç¤º
    document.getElementById('currentMonth').textContent = 
        `${year}å¹´${(month + 1).toString().padStart(2, '0')}æœˆ`;

    // ç”Ÿæˆæ—¥æœŸæ ¼å­
    let calendarHTML = '';
    for (let i = 0; i < firstDay; i++) {
        calendarHTML += `<div class="calendar-day"></div>`;
    }
    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const hasRecord = localStorage.getItem(`diary_${dateStr}`) !== null;
        calendarHTML += `
            <div class="calendar-day ${hasRecord ? 'has-record' : ''}">
                ${day}
            </div>
        `;
    }
    document.getElementById('calendarGrid').innerHTML = calendarHTML;

    // æ›´æ–°è¿›åº¦æ¡
    updateProgress();
}

function changeMonth(offset) {
    currentDate.setMonth(currentDate.getMonth() + offset);
    updateCalendar();
}

function updateProgress() {
    // ç»Ÿè®¡æ‰€æœ‰æ—¥è®°è®°å½•ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
    let totalRecords = 0;
    
    // éå†localStorageå¹¶è¿‡æ»¤æ—¥è®°æ¡ç›®
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('diary_')) {
            try {
                // ç¡®ä¿è§£æä¸ºæœ‰æ•ˆæ•°ç»„
                const records = JSON.parse(localStorage.getItem(key)) || [];
                totalRecords += records.length;
            } catch (e) {
                console.error("è§£ææ—¥è®°è®°å½•å‡ºé”™:", e);
            }
        }
    }
    
    // æ›´æ–°è¿›åº¦æ¡ï¼ˆä¿®æ­£ç‰ˆï¼‰
    const progressBar = document.querySelector('.progress-bar');
    const percentage = Math.min(totalRecords * 10, 100); // æ¯10æ¡è®°å½•å¡«æ»¡100%
    
    // ä½¿ç”¨CSSå˜é‡æ–¹å¼æ›´æ–°è¿›åº¦
    progressBar.style.setProperty('--progress-width', `${percentage}%`);
    
    // æ›´æ–°æ–‡å­—ï¼ˆç¡®ä¿æ•°å€¼æ˜¾ç¤ºæ­£ç¡®ï¼‰
    document.getElementById('progressText').textContent = 
        `ä¼´ä½ ${totalRecords}åœºè¿½é£`;
}
// åˆå§‹åŒ–æ—¥å†
window.addEventListener('load', updateCalendar);
</script>
</body>
</html>
